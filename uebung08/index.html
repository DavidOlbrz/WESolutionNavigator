<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Übung 08</title>
    <link href="../css/uebung.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="scripts/asynchronous.js"></script>
</head>
<body>
<a href="..">[Zurück]</a>
<h1>Übung 8: Asynchrones JavaScript</h1>

<div class="aufgaben_nav">
    <h2>Aufgaben</h2>
    <nav><a href="#task1">8.1 Promises</a></nav>
    <nav><a href="#task2">8.2 async/await</a></nav>
    <nav><a href="#task3">8.3 WWW-Navigator</a></nav>
</div>

<h2 id="task1">8.1 Promises</h2>

<p>
    Erstellen Sie auf Ihrem lokalen Server (localhost) zwei Text-Dateien <code>A.txt</code> und <code>B.txt</code> mit
    ungefähr gleich vielen Zeilen. Laden Sie mit der fetch-API parallel beide Text-Dateien vom Server. Geben Sie auf
    einer Webseite den Inhalt beider Dateien zeilenweise aus, wobei der Anfang der Zeile aus <code>A.txt</code> und das
    Ende aus <code>B.txt</code> stammen soll. Die beiden Dateien sollen also zeilenweise konkateniert werden. Erzielen
    Sie max. Geschwindigkeit durch maximale Parallelität. Achten Sie gleichzeitig auf Korrektheit. Verwenden Sie dabei
    ausschließlich die Promise-API ohne async/await.
</p>
<button onclick="runTask1()">Run script</button>
(Output in der Konsole)
<h3>Source Code</h3>
<pre>
    <code>
const fileA = 'assets/A.txt';
const fileB = 'assets/B.txt';

function runTask1() {
    Promise.all([fetch(fileA), fetch(fileB)])
        .then(responses => Promise.all(responses.map(response => response.text())))
        .then(texts => {
            const linesA = texts[0].split('\n');
            const linesB = texts[1].split('\n');
            const numLines = Math.min(linesA.length, linesB.length);
            for (let i = 0; i < numLines; i++) {
                console.log(`${linesA[i]} , ${linesB[i]}`);
            }
        })
}
    </code>
</pre>

<h2 id="task2">8.2 async/await</h2>

<p>
    Lösen Sie die letzte Aufgabe mit async/await statt Promise.
</p>
<button onclick="runTask2()">Run script</button>
(Output in der Konsole)
<h3>Source Code</h3>
<pre>
    <code>
const fileA = 'assets/A.txt';
const fileB = 'assets/B.txt';

async function runTask2() {
    const responseA = await fetch(fileA);
    const responseB = await fetch(fileB);
    const textA = await responseA.text();
    const textB = await responseB.text();
    const linesA = textA.split('\n');
    const linesB = textB.split('\n');
    const numLines = Math.min(linesA.length, linesB.length);
    for (let i = 0; i < numLines; i++) {
        console.log(`${linesA[i]} , ${linesB[i]}`);
    }
}
    </code>
</pre>

<h2 id="task3">8.3 WWW-Navigator</h2>

<p>
    Schreiben Sie einen Navigator für die Fachbegriffe des WWW zu den Oberthemen HTML, CSS und JavaScript. Im Hauptmenü
    sollen diese 3 Oberthemen zur Auswahl stehen. Im Untermenü soll eine zugehörige Liste von Fachbegriffen zum
    jeweiligen ausgewählten Oberthema stehen. In der Mitte soll eine Dokumentation zum ausgewählten Fachbegriff
    erscheinen.
</p>
<p>
    Schreiben Sie in HTML und CSS nur den responsiven Rahmen für einen solchen WWW-Navigator. Dabei können Sie auch ein
    schöneres Layout als das hier gezeigte erstellen. Die Inhalte sollen in einer JSON-Datei extern gelagert werden. Mit
    der fetch-API soll die JSON-Datei asynchron nicht-blockierend geladen werden, und zwar nur einmal, nicht mehrfach.
    (d.h. Sparen Sie Internet-Bandbreite.) Sobald die Inhalte angekommen sind, sollen sie im Browser auch sofort
    angezeigt werden.
</p>
<p>
    Fügen Sie selbst in die JSON-Datei zusätzliche Inhalte zu Themen der Vorlesung als Strings beispielhaft ein. Wenn
    Sie Inhalte aus fremden Quellen kopieren, so schreiben Sie bitte stets die Quelle als externe Ressource hinzu. Diese
    soll dann auf der rechten Seite im WWW-Navigator erscheinen.
</p>
<a href="nr3.html" target="_blank">
    <button>In neuem Tab öffnen</button>
</a>
<h3>Source Code</h3>
<pre>
    <code>
&lt;!DOCTYPE html&gt;
&lt;html lang="de"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;8.3 WWW-Navigator&lt;/title&gt;
    &lt;meta name="viewport" content="width=device-width"&gt;
    &lt;link href="/css/default.css" rel="stylesheet"&gt;
    &lt;style&gt;
        body {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: 5rem auto 3rem;
            grid-template-areas:
                'header header header header'
                'left center center right'
                'footer footer footer footer';
            margin: 0;
            height: 100vh;
            background: var(--color-surface-400);
        }

        header {
            grid-area: header;
            background: var(--color-surface-300);
        }

        header h1 {
            color: white;
            text-align: center;
            margin: 0 0 0.5rem;
        }

        header div {
            display: flex;
            justify-content: space-around;
        }

        header div a {
            background: var(--color-surface-400);
            width: 100%;
            text-align: center;
            font-size: 20px;
            border-radius: 5px;
            margin: 0 1rem;
        }

        header div a:hover {
            background: var(--color-surface-500);
        }

        #left-sidebar {
            grid-area: left;
            display: flex;
            flex-direction: column;
        }

        #left-sidebar a {
            padding: 1rem 0 1rem 1rem;
            font-size: 20px;
        }

        #left-sidebar a:hover {
            background: var(--color-surface-500);
        }

        .current {
            background: var(--color-primary-500);
            color: black;
        }

        .current:hover {
            background: var(--color-primary-500);
        }

        main {
            grid-area: center;
            background: var(--color-surface-100);
            border-radius: 10px;
            padding: 1rem;
            font-size: 20px;
        }

        #right-sidebar {
            grid-area: right;
        }

        #right-sidebar ul li a {
            color: white;
            padding-right: 0.5rem;
        }

        footer {
            grid-area: footer;
            background: var(--color-surface-300);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        footer a {
            color: white;
            text-align: center;
            text-decoration: underline;
            margin: 0 1rem;
        }

        @media only screen and (max-width: 1000px) {
            body {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: 5rem auto fit-content(0%) 3rem;
                grid-template-areas:
                'header header header'
                'left center center'
                'right right right'
                'footer footer footer';
            }

        }

        @media only screen and (max-width: 800px) {
            body {
                grid-template-columns: 1fr;
                grid-template-rows: 10rem  10rem auto 5rem 2rem;
                grid-template-areas:
                'header'
                'left'
                'center'
                'right'
                'footer';
            }

            header div {
                flex-direction: column;
                align-items: center;
            }

            header div a {
                width: 50%;
                margin: 0.1rem 0;
            }


        }
    &lt;/style&gt;
    &lt;script&gt;
        let information;
        let categories;
        let chapters;
        let currentCategory;
        let currentChapter;

        onload = function () {
            fetch('assets/www_info.json')
                .then(response =&gt; response.json())
                .then(json =&gt; information = json)
                .then(() =&gt; buildHeaderNav());
        }

        function buildHeaderNav() {
            // get all categories
            categories = Object.keys(information);
            // create navigation buttons
            categories.forEach(function (x) {
                let item = document.createElement('a');
                item.innerHTML = x.toUpperCase();
                item.addEventListener('click', () =&gt; switchCategory(x));
                document.getElementById('category-nav').appendChild(item);
            });
            // set the first category as the first one
            document.getElementById('category-nav').children.item(0).className = 'current';
            currentCategory = categories[0];
            // get chapters of category and set variable to the first one
            chapters = Object.keys(information[currentCategory]);
            currentChapter = chapters[0];
            // build sidebar navigation and display the content of the first chapter
            buildSidebarNav();
            switchChapter(currentChapter);
        }

        function switchCategory(category) {
            console.log(`Switching to Category ${category}`);
            // remove "current" class from category button
            const categoryNav = document.getElementById('category-nav').children;
            categoryNav.item(categories.indexOf(currentCategory)).className = '';
            // set variable to new category
            currentCategory = category;
            // get chapters of category and set variable to the first one
            chapters = Object.keys(information[currentCategory]);
            currentChapter = chapters[0];
            // add "current" class to current category button
            categoryNav.item(categories.indexOf(category)).className = 'current';
            // build sidebar navigation and display the content of the first chapter
            buildSidebarNav();
            switchChapter(currentChapter);
        }

        function buildSidebarNav() {
            // remove previous navigation
            document.querySelector('#left-sidebar').innerHTML = '';
            // create new navigation buttons
            chapters.forEach(function (x) {
                let item = document.createElement('a');
                item.innerHTML = x;
                item.addEventListener('click', () =&gt; switchChapter(x));
                document.getElementById('left-sidebar').appendChild(item);
            })
            // add "current" class to the current button
            document.getElementById('left-sidebar').children.item(0).className = 'current';
        }

        function switchChapter(chapter) {
            // remove "current" class from chapter button
            const chapterNav = document.getElementById('left-sidebar').children;
            chapterNav.item(chapters.indexOf(currentChapter)).className = '';
            // set variable to new chapter
            currentChapter = chapter;
            // add "current" class to current chapter button
            chapterNav.item(chapters.indexOf(chapter)).className = 'current';
            // build content
            buildContent();
        }

        function buildContent() {
            // replace previous content with new content
            document.getElementsByTagName('main').item(0).innerHTML = information[currentCategory][currentChapter]['content'];
            // build references list
            const references = information[currentCategory][currentChapter]['references'];
            let refItems = '&lt;ul&gt;';
            references.forEach(x =&gt; refItems += '&lt;li&gt;&lt;a href=' + x + ' target=_blank&gt;' + x + '&lt;/li&gt;&lt;/a&gt;');
            document.getElementById('right-sidebar-content').innerHTML = refItems + '&lt;/ul&gt;';
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;header&gt;
    &lt;h1&gt;WWW-Navigator&lt;/h1&gt;
    &lt;div id="category-nav"&gt;
        &lt;!-- Items will be generated based on the json file --&gt;
    &lt;/div&gt;
&lt;/header&gt;
&lt;aside id="left-sidebar"&gt;
    &lt;!-- Items will be generated based on the json file --&gt;
&lt;/aside&gt;
&lt;main&gt;
    &lt;!-- Content will be generated based on the json file --&gt;
&lt;/main&gt;
&lt;aside id="right-sidebar"&gt;
    &lt;h3 style="text-align: center"&gt;Zusätzliche Informationen:&lt;/h3&gt;
    &lt;div id="right-sidebar-content"&gt;
        &lt;!-- Content will be generated based on the json file --&gt;
    &lt;/div&gt;
&lt;/aside&gt;
&lt;footer&gt;
    &lt;a&gt;Sitemap&lt;/a&gt;
    &lt;a&gt;Home&lt;/a&gt;
    &lt;a&gt;News&lt;/a&gt;
    &lt;a&gt;Contact&lt;/a&gt;
    &lt;a&gt;About&lt;/a&gt;
&lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;
    </code>
</pre>
</body>
</html>