<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Übung 05 | Solution-Navigator</title>
    <link href="/assets/favicon.ico" rel="icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css"
          integrity="sha512-P9vJUXK+LyvAzj8otTOKzdfF1F3UYVl13+F8Fof8/2QNb8Twd6Vb+VD52I7+87tex9UXxnzPgWA3rH96RExA7A=="
          crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css"
          integrity="sha512-tk4nGrLxft4l30r9ETuejLU0a3d7LwMzj0eXjzc16JQj+5U1IeVoCuGLObRDc3+eQMUcEQY1RIDPGvuA7SNQ2w=="
          crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <script src="https://kit.fontawesome.com/37beb9f2cd.js" crossorigin="anonymous"></script>
    <link href="../css/uebung.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="/scripts/toggleCode.js"></script>
</head>
<body>
<header id="top">
    <script src="/scripts/header.js"></script>
    <a id="logo" href="..">
        <svg height="2.5rem" width="3.5rem">
            <rect x="0" y="0" height="100%" width="100%" fill="none" stroke="white" stroke-width="5"></rect>
            <text x="50%" y="50%" text-anchor="middle" dominant-baseline="central" font-size="2rem" fill="white">
                SN
            </text>
        </svg>
        <span id="logo-text">Solution Navigator</span>
    </a>
    <nav id="header-nav">
        <i id="menu-button" class="fa-solid fa-bars" onclick="openMenu()"></i>
        <div id="menu-container">
            <ul>
                <li>
                    <a href="..">Übersicht</a>
                </li>
                <li class="current">
                    <script src="/scripts/taskjumper.js"></script>
                    <label id="task-select">
                        <select onchange="jumpToTask(this.value)">
                            <option value="0">Zu Übung springen</option>
                            <option value="1">Übung 01</option>
                            <option value="2">Übung 02</option>
                            <option value="3">Übung 03</option>
                            <option value="4">Übung 04</option>
                            <option value="5" selected>Übung 05</option>
                            <option value="6">Übung 06</option>
                            <option value="7">Übung 07</option>
                            <option value="8">Übung 08</option>
                            <option value="9">Übung 09</option>
                            <option value="10">Übung 10</option>
                            <option value="11">Übung 11</option>
                            <option value="12">Übung 12</option>
                        </select>
                    </label>
                </li>
                <li>
                    <a href="../about.html">Über mich</a>
                </li>
                <li>
                    <a href="../credits.html">Credits</a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<h1>Übung 5: Document Object Model (DOM)</h1>

<div class="aufgaben_nav container">
    <h2>Aufgaben</h2>
    <nav><a href="#task1">5.1. Performanz-Messungen von DOM-Operationen</a></nav>
    <nav><a href="#task2">5.2. Rednerliste mit Zeitmessung <i class="fa-solid fa-star" style="color: gold"
                                                              title="Klausurrelevant"></i></a></nav>
    <nav><a href="#task3">5.3. TopSort als Web-App</a></nav>
</div>

<h2 id="task1">5.1. Performanz-Messungen von DOM-Operationen</h2>

<div class="container">
    <p style="margin-top: 0">Implementieren Sie Performanz-Messungen zum Vergleich von</p>
    <ul>
        <li><code>innerHTML</code>,</li>
        <li><code>innerText</code>,</li>
        <li><code>textContent</code> und</li>
        <li><code>outerHTML</code></li>
    </ul>
    <p>
        selbstständig in JavaScript durch Nutzung der <a href="https://www.w3schools.com/js/js_htmldom.asp"
                                                         target="_blank">DOM-API</a>.
        Geben Sie die Messergebnisse als Tabelle aus. Verwenden Sie
        die eingebauten Zeitmessung-Funktionen <a
            href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now"
            target="_blank"><code>performance.now()</code></a>, siehe auch
        <a href="https://developers.google.com/web/updates/2012/08/When-milliseconds-are-not-enough-performance-now"
           target="_blank">When-milliseconds-are-not-enough-performance-now</a>. Suchen Sie eine möglichst kurze und
        elegante
        Lösung.
    </p>
    <p>
        Dabei ist zu beachten, dass Browser, um potenzielle Sicherheitsbedrohungen wie <a
            href="https://spectreattack.com/"
            target="_blank">Meltdown oder
        Spectre</a>
        zu minimieren,
        den zurückgegebenen Wert normalerweise um einen bestimmten Betrag runden. Dies führt zu einer gewissen
        Ungenauigkeit. Beispielsweise rundet Firefox die zurückgegebene Zeit in Schritten von 1 Millisekunde. Diese
        Zwangsrundung kann man jedoch wiederum abschalten mittels der Firefox-Einstellung
        <code>privacy.reduceTimerPrecision</code>,
        siehe <a
            href="https://stackoverflow.com/questions/50117537/how-to-get-microsecond-timings-in-javascript-since-spectre-and-meltdown"
            target="_blank">How to get microsecond timings in JavaScript since Spectre and Meltdown</a>.
    </p>
    <br>
    <a href="nr1.html" target="_blank">
        <button><i class="fa-solid fa-arrow-up-right-from-square"></i> Seite öffnen</button>
    </a>
    <br><br>
    <button onclick="toggleCode('task1-code')"><i class="fa-solid fa-code"></i> Source Code</button>
    <br>
    <pre id="task1-code" class="code-block">
        <code>function testPerformance() {
    const item = document.createElement('div');
    document.body.appendChild(item);

    const results = [];
    let start, end;

    start = performance.now();
    item.innerHTML = 'test';
    end = performance.now();
    results.push({name: 'innerHTML', value: (end - start) + ' ms'});

    start = performance.now();
    item.innerText = 'test';
    end = performance.now();
    results.push({name: 'innerText', value: (end - start) + ' ms'});

    start = performance.now();
    item.textContent = 'test';
    end = performance.now();
    results.push({name: 'textContent', value: (end - start) + ' ms'});

    start = performance.now();
    item.outerHTML = 'test';
    end = performance.now();
    results.push({name: 'outerHTML', value: (end - start) + ' ms'});

    console.table(results);

    document.querySelector('body').innerHTML = '';
}

testPerformance();</code></pre>
</div>
<hr>

<h2 id="task2">5.2. Rednerliste mit Zeitmessung <i class="fa-solid fa-star" style="color: gold"
                                                   title="Klausurrelevant"></i></h2>

<div class="container">
    <p style="margin-top: 0">
        Implementieren Sie die interaktive Anwendung "Rednerliste mit Zeitmessung" selbstständig in JavaScript durch
        Nutzung
        der <a href="https://www.w3schools.com/js/js_htmldom.asp" target="_blank">DOM-API</a> und der <a
            href="https://www.w3schools.com/js/js_timing.asp" target="_blank">Timer-Funktionen</a>.
        Neue
        Redner sollen auf Knopfdruck hinzugefügt werden können. Deren Uhr wird
        dann sofort automatisch gestartet und alle anderen Uhren angehalten. Bei jedem Redner soll die individuelle,
        gemessene Redezeit sekundengenau angezeigt werden. Für jeden Redner soll es einen eigenen Start-/Stopp-Button
        geben.
        Es soll immer nur eine Uhr laufen. Angezeigt werden sollen die bisherigen Summenzeiten aller Redebeiträge der
        betreffenden Person. Suchen Sie eine möglichst kurze und elegante Lösung. Achten Sie gleichzeitig auf gute
        Usability: z.B. wenn die Eingabe mit einem Return beendet wird, soll der Klick auf den Button nicht mehr
        erforderlich sein.
    </p>
    <br>
    <iframe id="task2-iframe" src="nr2.html" width="400px" height="300px"></iframe>
    <br>
    <button onclick="document.getElementById('task2-iframe').contentWindow.location.reload()"><i
            class="fa-solid fa-arrows-rotate"></i> Rednerliste zurücksetzen
    </button>
    <br><br>
    <button onclick="toggleCode('task2-code')"><i class="fa-solid fa-code"></i> Source Code</button>
    <br>
    <pre id="task2-code" class="code-block">
        <code>&lt;!DOCTYPE html&gt;
&lt;html lang="de"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;5.2. Rednerliste mit Zeitmessung&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Rednerliste&lt;/h1&gt;

&lt;script&gt;
    onload = function () {
        setInterval(update, 1000);
    }

    function Speaker(name) {
        this.name = name;
        this.time = 0;
        this.timer = undefined;
        this.startTimer = function () {
            this.timer = setInterval(() =&gt; this.time++, 1000);
        };
        this.stopTimer = function () {
            clearInterval(this.timer);
        };
    }

    const speakers = [];
    let buttons = [];
    let currentSpeaker = undefined;

    function addSpeaker(name) {
        // if text field is empty, do not add a new speaker
        if (name === '') {
            return;
        }
        // create a new speaker
        const speaker = new Speaker(name);
        speakers.push(speaker);
        let speakerIndex = speakers.length - 1;
        // add speaker to the list
        let item = document.createElement('li');
        item.innerHTML = speaker.name + '&lt;a class="timer"&gt; 00:00:00 &lt;/a&gt;&lt;input class="timer-button" type="button"&gt;';
        document.getElementById('speaker-list').appendChild(item);
        document.getElementById('speaker-input').value = '';
        // update buttons array
        buttons = document.getElementsByClassName('timer-button');
        // start the timer
        startTimers(speakerIndex);
    }

    function startTimers(speakerNo) {
        currentSpeaker = speakerNo;
        for (let x in speakers) {
            if (x == speakerNo) {
                speakers[x].startTimer();
                buttons[x].value = 'Stopp!';
                buttons[x].onclick = function () {
                    stopTimers(x);
                };
            } else {
                speakers[x].stopTimer();
                buttons[x].value = 'Start!';
                buttons[x].onclick = function () {
                    startTimers(x);
                };
            }
        }
    }

    function stopTimers(speakerNo) {
        console.log('Hat funktioniert!');
        speakers[speakerNo].stopTimer();
        buttons[speakerNo].value = 'Start!';
        buttons[speakerNo].onclick = function () {
            startTimers(speakerNo)
        };
    }

    function update() {
        const items = document.getElementsByClassName('timer');
        for (let x in speakers) {
            items[x].innerHTML = timeToString(speakers[x]);
        }
    }

    function timeToString(speaker) {
        const time = speaker.time;
        let hours = Math.floor(time / 3600);
        let minutes = Math.floor((time % 3600) / 60);
        let seconds = Math.floor((time % 3600) % 60);
        return ' ' + toTwoDigitString(hours) + ':' + toTwoDigitString(minutes) + ':' + toTwoDigitString(seconds) + ' ';
    }

    function toTwoDigitString(number) {
        return (number &lt; 10) ? ('0' + number) : number;
    }
&lt;/script&gt;

&lt;form method="dialog"&gt;
    &lt;label&gt;
        Neuer Redner:
        &lt;input id="speaker-input" type="text" placeholder="Name"&gt;
        &lt;input type="submit" value="Hinzufügen" onclick="addSpeaker(document.getElementById('speaker-input').value)"&gt;
    &lt;/label&gt;
&lt;/form&gt;
&lt;ul id="speaker-list"&gt;
    &lt;!-- Speakers will be added here --&gt;
&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
<hr>

<h2 id="task3">5.3. TopSort als Web-App</h2>

<div class="container">
    <p style="margin-top: 0">
        Schreiben Sie eine Weboberfläche, in der man beliebige Beziehungen (Vorrang-Relationen) eingeben kann, für die
        dann
        die topologische Sortierung per Knopfdruck auf der Webseite ausgegeben wird.
    </p>
    <p>
        Für die Eingabe können Sie HTML5-Eingabefelder oder das HTML-Attribut <code>contenteditable</code> verwenden.
    </p>
    <br>
    <iframe id="task3-iframe" src="nr3.html" width="600px" height="500px"></iframe>
    <br>
    <button onclick="document.getElementById('task3-iframe').contentWindow.location.reload()"><i
            class="fa-solid fa-arrows-rotate"></i> Zurücksetzen
    </button>
    <br><br>
    <button onclick="toggleCode('task3-code')"><i class="fa-solid fa-code"></i> Source Code</button>
    <br>
    <pre id="task3-code" class="code-block">
        <code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;5.3 TopSort als Web-App&lt;/title&gt;
    &lt;script&gt;
        let inputArray = [];

        function compare(a, b) {
            if (a[0] === b[1]) {
                return 1;
            } else if (a[1] === b[0]) {
                return -1;
            } else {
                return 0;
            }
        }

        function topSort(input) {
            let array = input;
            array.sort(compare);
            const sorted = new Set;
            for (let x in array) {
                sorted.add(array[x][0]);
                if (x == array.length - 1) {
                    sorted.add(array[x][1]);
                }
            }
            return sorted;
        }

        function testTopSort() {
            const array = [["schlafen", "studieren"], ["essen", "studieren"], ["studieren", "prüfen"]];
            const sorted = topSort(array);
            console.assert(Array.from(sorted).toString() === "schlafen,essen,studieren,prüfen");
        }

        function addTask(a, b) {
            inputArray.push([a, b]);
            let item = document.createElement('li');
            item.innerHTML = a + ", " + b;
            document.getElementById('inputs').appendChild(item);
            document.getElementById('input-a').value = "";
            document.getElementById('input-b').value = "";
        }

        function generateResults() {
            document.querySelector('#sorted-result').innerHTML = '';
            if (inputArray.length === 0) {
                const item = document.createElement("li");
                item.innerHTML = "Sie haben noch keine Eingaben gemacht!"
                document.getElementById('sorted-result').appendChild(item);
            } else {
                const result = Array.from(topSort(inputArray));
                console.log(result);
                for (let x in result) {
                    const item = document.createElement("li");
                    item.innerHTML = result[x];
                    console.log(x + ': Task ' + result[x]);
                    document.getElementById('sorted-result').appendChild(item);
                }
            }
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;TopSort&lt;/h1&gt;
&lt;form method="dialog"
      onsubmit="addTask(document.getElementById('input-a').value, document.getElementById('input-b').value)"&gt;
    &lt;label&gt;
        Voraussetzung
        &lt;input id="input-a" type="text" required&gt;
    &lt;/label&gt;
    &lt;label&gt;
        Aufgabe
        &lt;input id="input-b" type="text" required&gt;
    &lt;/label&gt;
    &lt;input type="submit" value="Fertig"&gt;
&lt;/form&gt;
&lt;hr&gt;
&lt;h2&gt;Eingaben&lt;/h2&gt;
&lt;ul id="inputs"&gt;
    &lt;!-- Inputs will appear in the list --&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Ergebnis&lt;/h2&gt;
&lt;button onclick="generateResults()"&gt;Ergebnis anzeigen&lt;/button&gt;
&lt;ol id="sorted-result"&gt;
    &lt;!-- result will appear here --&gt;
&lt;/ol&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>

<a id="top_button" href="#top"><i class="fa-solid fa-arrow-up"></i></a>
</body>
</html>